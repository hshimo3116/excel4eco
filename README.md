# excel4eco
エコファーマ申請書類作成支援Excelシート

このリポジトリでは Excel のマクロコードをテキスト管理します。
`.xlsm` ワークブックはこのリポジトリには含まれていないため、`EXCEL_FILE` で使用するファイルを指定してください。
スクリプトは Excel がインストールされた Windows 環境での実行を前提としています。
VBA プロジェクトを抽出するには、Excel のオプションで
「VBA プロジェクト オブジェクト モデルへのアクセスを信頼する」を有効にしてください。
この設定が無効だと VBS スクリプトからプロジェクトにアクセスできず、
`VBProject is inaccessible` というエラーが表示されます。
また、パスワードで保護されたプロジェクトは解除しないと抽出できません。
`make source` で `EXCEL_FILE` からマクロを抽出し、`lib` ディレクトリに保存します。
モジュール名に `\\/:*?"<>|` が含まれる場合、ファイル名として使用できないため
抽出時にこれらの文字はアンダースコアに置き換えられます。
VBA プロジェクトがパスワードで保護されていると
`VBA project is protected` というメッセージが表示され、抽出は行えません。
`make install` で `lib` のコードを `EXCEL_FILE` に組み込みます。

## 使い方
1. `EXCEL_FILE` 変数に対象の `.xlsm` ファイルを指定します。指定しない場合は
   Makefile と同じディレクトリにある `workbook.xlsm` を使用します。
   指定したファイルが存在しない場合、各VBSスクリプトはエラーを表示して終了します。
   パスに空白が含まれる場合は、変数値をダブルクオートで囲んでください。
2. `make source` を実行してマクロを抽出します。
3. `make edit` で `lib` 内の `.bas` `.cls` `.frm` を開きます。`$EDITOR` が未設定の場合は `emacs -nw` が使用されます。
4. `make install` でマクロを再度ファイルへ組み込みます。

現在のバージョンは `VERSION` ファイルを参照してください。
